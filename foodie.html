<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foodie Match: é»ƒé‡‘ç››å…¸</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Noto+Sans+TC:wght@500;700&display=swap');

        :root {
            --primary: #4ECDC4;
            --accent: #FF6B6B;
            --success: #6BCB77;
            --warning: #FFD93D;
            --text: #2C3E50;
            --bg-sky: #87CEEB;
            --bg-cloud: #E0F7FA;
            --gold: #FFD700;
        }

        body {
            font-family: 'Fredoka', 'Noto Sans TC', sans-serif;
            background: linear-gradient(180deg, var(--bg-sky) 0%, var(--bg-cloud) 100%);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            user-select: none;
        }

        /* èƒŒæ™¯è£é£¾ */
        body::before { content: "â˜ï¸"; position: absolute; top: 10%; left: 10%; font-size: 5rem; opacity: 0.8; animation: float 25s linear infinite; z-index: -1; }
        body::after { content: "â˜ï¸"; position: absolute; top: 20%; right: 10%; font-size: 4rem; opacity: 0.6; animation: float 30s linear infinite reverse; z-index: -1; }
        @keyframes float { from { transform: translateX(-100px); } to { transform: translateX(100px); } }

        #app {
            background: rgba(255, 255, 255, 0.95);
            width: 90%; max-width: 700px; height: 95vh;
            border-radius: 30px;
            box-shadow: 0 15px 0 rgba(0,0,0,0.1), 0 20px 40px rgba(0,0,0,0.2);
            padding: 15px;
            box-sizing: border-box;
            display: flex; flex-direction: column; position: relative;
            border: 8px solid #FFF;
            z-index: 10; /* ç¢ºä¿åœ¨ confetti ä¹‹ä¸Š */
        }

        /* HUD */
        .hud-bar {
            display: flex; justify-content: space-between;
            background: #f0f8ff; padding: 8px 15px;
            border-radius: 15px; margin-bottom: 10px;
            font-size: 1.2rem; font-weight: 700; color: #555;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        /* é¡Œç›®èˆ‡æ”¶é›†æ§½å€åŸŸ */
        .question-area {
            background: #fff;
            border-radius: 20px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .emoji-display {
            font-size: 7rem;
            margin-bottom: 10px;
            animation: bounce 2s infinite;
        }

        /* æ”¶é›†æ§½ (Slot) */
        .answer-slot {
            display: flex;
            gap: 10px;
            background: #eee;
            padding: 10px;
            border-radius: 15px;
            width: 90%;
            justify-content: center;
            min-height: 60px;
            box-shadow: inset 0 3px 5px rgba(0,0,0,0.1);
        }

        .slot-item {
            flex: 1;
            background: #fff;
            border: 2px dashed #ccc;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #ccc;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .slot-item.filled {
            border-style: solid;
            color: #fff;
            transform: scale(1.05);
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        .slot-item.filled-cn { background: var(--primary); border-color: var(--primary); }
        .slot-item.filled-en { background: var(--accent); border-color: var(--accent); font-family: 'Fredoka'; }

        /* è¨ˆæ™‚æ¢ */
        .timer-wrap {
            width: 100%; height: 10px; background: #eee; border-radius: 5px; margin: 10px 0; overflow: hidden;
        }
        .timer-fill { height: 100%; background: var(--success); width: 100%; transition: width 0.1s linear; }

        /* é¸é …å€ */
        .options-grid {
            display: grid; width: 100%; gap: 12px; margin-top: auto; flex-grow: 1;
            align-content: center;
        }

        button.opt-btn {
            border: none; cursor: pointer;
            background: white; color: var(--text);
            border: 3px solid #ddd; box-shadow: 0 4px 0 #ccc;
            border-radius: 15px; padding: 15px;
            font-size: 1.5rem; font-weight: 600;
            transition: all 0.1s;
            position: relative;
        }
        
        button.opt-btn:active { top: 4px; box-shadow: none; }
        
        /* éšæ®µæ¨£å¼ */
        .phase-cn button.opt-btn { border-color: var(--primary); color: var(--text); font-family: 'Noto Sans TC'; }
        .phase-cn button.opt-btn:hover { background: #e0f7fa; }

        .phase-en button.opt-btn { border-color: var(--accent); color: var(--accent); font-family: 'Fredoka'; }
        .phase-en button.opt-btn:hover { background: #ffebee; }

        /* ç•«é¢åˆ‡æ› */
        .screen { display: none; flex-direction: column; height: 100%; align-items: center; justify-content: center; text-align: center; }
        .screen.active { display: flex; }

        .btn-large {
            background: var(--accent); color: white; font-size: 1.8rem; padding: 15px 40px; border-radius: 50px;
            border: none; box-shadow: 0 6px 0 #d43f3f; margin-top: 20px; cursor: pointer;
        }
        .btn-large:active { transform: translateY(6px); box-shadow: none; }

        /* åé¥‹å±¤ */
        .feedback-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(255,255,255,0.8);
            display: none; align-items: center; justify-content: center; z-index: 100;
            flex-direction: column;
            backdrop-filter: blur(5px);
        }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* --- æ–°å¢ï¼šé‡‘å…‰ç‡¦ç‡¦çç›ƒç‰¹æ•ˆ --- */
        .golden-trophy {
            font-size: 8rem;
            /* åˆ©ç”¨ text-shadow è£½é€ å¤šå±¤é‡‘å…‰ */
            text-shadow: 0 0 10px var(--gold), 0 0 20px var(--warning), 0 0 40px var(--gold);
            animation: trophyShine 1.5s ease-in-out infinite alternate;
        }
        @keyframes trophyShine {
            from { transform: scale(1); filter: brightness(100%); }
            to { transform: scale(1.15); filter: brightness(120%) drop-shadow(0 0 20px var(--gold)); }
        }

        /* --- æ–°å¢ï¼šConfetti ç¢ç´™èŠ±ç‰¹æ•ˆ --- */
        .confetti {
            position: absolute; z-index: 5; /* åœ¨APPä¹‹ä¸‹ï¼ŒèƒŒæ™¯ä¹‹ä¸Š */
            width: 10px; height: 10px;
            background: #f00;
            top: -20px;
            animation: fall linear forwards;
        }
        @keyframes fall {
            to { transform: translateY(105vh) rotate(720deg); }
        }

    </style>
</head>
<body>

<div id="app">
    <div id="start-screen" class="screen active">
        <div style="font-size: 6rem; margin-bottom: 20px;">ğŸ§©ğŸ±ğŸ”¡</div>
        <h1>Foodie Match<br>é£Ÿå®¢å¤§æŒ‘æˆ°</h1>
        <div style="background:#FFF; padding:20px; border-radius:20px; margin:20px; font-size:1.1rem; color:#555;">
            1. Developed by <span style="color:var(--primary); font-weight:bold;">Shirley</span> Du<br>
            2. First, choose <span style="color:orange; font-weight:bold;">Chinese</span><br>
            3. Then, choose <span style="color:var(--accent); font-weight:bold;">English</span> å®Œæˆé…å°
        </div>
        <button class="btn-large" onclick="initGame()">Start</button>
    </div>

    <div id="game-screen" class="screen" style="justify-content: flex-start;">
        <div class="hud-bar">
            <span>Level <span id="lvl-num">1</span></span>
            <span style="color:var(--accent)">â­ <span id="score-num">10</span></span>
        </div>

        <div class="question-area">
            <div class="emoji-display" id="q-emoji">ğŸ</div>
            
            <div class="answer-slot">
                <div id="slot-cn" class="slot-item">ä¸­æ–‡</div>
                <div id="slot-en" class="slot-item">English</div>
            </div>
        </div>
        
        <div class="timer-wrap"><div id="timer-bar" class="timer-fill"></div></div>
        
        <div id="hint-text" style="color:#888; margin-bottom:5px; font-weight:bold;">è«‹é¸æ“‡æ­£ç¢ºçš„ä¸­æ–‡</div>

        <div id="options-container" class="options-grid"></div>
    </div>

    <div id="feedback-overlay" class="feedback-overlay">
        <div id="fb-icon" style="font-size: 6rem;"></div>
        <div id="fb-text" style="font-size: 2.5rem; font-weight:900; margin-top:10px;"></div>
    </div>

    <div id="levelup-screen" class="screen">
        <div style="font-size: 5rem;">ğŸš€</div>
        <h1 style="color:var(--success)">LEVEL UP!</h1>
        <button class="btn-large" onclick="startLevel()">ä¸‹ä¸€é—œ</button>
    </div>

    <div id="gameover-screen" class="screen">
        <div style="font-size: 5rem;">ğŸ’”</div>
        <h1>æŒ‘æˆ°å¤±æ•—</h1>
        <button class="btn-large" onclick="initGame()">é‡è©¦</button>
    </div>

    <div id="win-screen" class="screen">
        <div class="golden-trophy">ğŸ†</div>
        <h1 style="color: var(--gold); text-shadow: 2px 2px 0 #d4a017;">å…¨éƒ¨é€šé—œ!</h1>
        <p>æœ€çµ‚åˆ†æ•¸: <span id="final-score" style="font-weight:bold; color:var(--accent)"></span></p>
        <button class="btn-large" onclick="initGame()">å†ä¾†ä¸€å±€</button>
    </div>
</div>

<script>
    // --- éŸ³æ•ˆç³»çµ± ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const SoundFX = {
        play: (freq, type, dur, vol=0.1) => {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + dur);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + dur);
        },
        lock: () => SoundFX.play(600, 'sine', 0.1), 
        win: () => {
            [523, 659, 784, 1046].forEach((f, i) => setTimeout(()=>SoundFX.play(f, 'triangle', 0.3), i*80));
        },
        lose: () => {
            SoundFX.play(150, 'sawtooth', 0.4);
            setTimeout(()=>SoundFX.play(100, 'sawtooth', 0.4), 200);
        }
    };

    // --- è³‡æ–™åº« (å·²å„ªåŒ–åœ–ç‰‡ç²¾æº–åº¦) ---
    const database = [
        {e:"apple", c:"è˜‹æœ", i:"ğŸ"}, {e:"banana", c:"é¦™è•‰", i:"ğŸŒ"}, 
        {e:"barbecue", c:"çƒ¤è‚‰", i:"ğŸ”¥ğŸ¥©"}, // å„ªåŒ–ï¼šç«ç„°+ç‰›æ’
        {e:"bean", c:"è±†", i:"ğŸ«˜"}, 
        {e:"beef", c:"ç‰›è‚‰", i:"ğŸ¥©"}, 
        {e:"beer", c:"å•¤é…’", i:"ğŸº"}, {e:"bread", c:"éºµåŒ…", i:"ğŸ"}, {e:"breakfast", c:"æ—©é¤", i:"ğŸŒ…ğŸ³"}, 
        {e:"brunch", c:"æ—©åˆé¤", i:"ğŸ¥ğŸ¥“"}, {e:"buffet", c:"è‡ªåŠ©é¤", i:"ğŸ±ğŸ²"}, 
        {e:"bun", c:"å°åœ“éºµåŒ…", i:"ğŸ¥¯"}, // å„ªåŒ–ï¼šè²æœæ›´åƒå°åœ“éºµåŒ…
        {e:"burger", c:"æ¼¢å ¡", i:"ğŸ”"}, 
        {e:"butter", c:"å¥¶æ²¹", i:"ğŸ§ˆ"}, {e:"cabbage", c:"é«˜éº—èœ", i:"ğŸ¥¬"}, {e:"cafeteria", c:"è‡ªåŠ©é¤é¤¨", i:"ğŸ«ğŸ½ï¸"}, {e:"cake", c:"è›‹ç³•", i:"ğŸ°"}, 
        {e:"candy", c:"ç³–æœ", i:"ğŸ¬"}, {e:"carrot", c:"ç´…è˜¿è””", i:"ğŸ¥•"}, {e:"cereal", c:"éº¥ç‰‡", i:"ğŸ¥£"}, {e:"cheese", c:"ä¹³é…ª", i:"ğŸ§€"}, 
        {e:"chocolate", c:"å·§å…‹åŠ›", i:"ğŸ«"}, {e:"coffee", c:"å’–å•¡", i:"â˜•"}, {e:"cola", c:"å¯æ¨‚", i:"ğŸ¥¤"}, {e:"cook", c:"å»šå¸«", i:"ğŸ‘¨â€ğŸ³"}, 
        {e:"cook", c:"ç…®", i:"ğŸ³ğŸ”¥"}, {e:"cookie", c:"é¤…ä¹¾", i:"ğŸª"}, {e:"corn", c:"ç‰ç±³", i:"ğŸŒ½"}, {e:"cream", c:"é®®å¥¶æ²¹", i:"ğŸ§"}, 
        {e:"delicious", c:"ç¾å‘³çš„", i:"ğŸ˜‹âœ¨"}, {e:"desk", c:"æ¡Œå­", i:"ğŸ–¥ï¸ğŸª‘"}, {e:"dessert", c:"ç”œé»", i:"ğŸ®"}, {e:"diet", c:"ç¯€é£Ÿ", i:"ğŸ¤ğŸ¥—"}, 
        {e:"diet", c:"é£²é£Ÿ", i:"ğŸ¥—ğŸ"}, {e:"dining room", c:"é£¯å»³", i:"ğŸ ğŸª‘"}, {e:"dinner", c:"æ™šé¤", i:"ğŸŒ™ğŸ½ï¸"}, {e:"dish", c:"ç›¤å­", i:"ğŸ½ï¸"}, 
        {e:"doughnut", c:"ç”œç”œåœˆ", i:"ğŸ©"}, {e:"drink", c:"å–", i:"ğŸ¥¤ğŸ‘„"}, {e:"drink", c:"é£²æ–™", i:"ğŸ¹"}, {e:"dumpling", c:"é¤ƒå­", i:"ğŸ¥Ÿ"}, 
        {e:"eat", c:"åƒ", i:"ğŸ½ï¸ğŸ‘„"}, {e:"egg", c:"è›‹", i:"ğŸ¥š"}, {e:"flour", c:"éºµç²‰", i:"ğŸ¥¡âšª"}, {e:"food", c:"é£Ÿç‰©", i:"ğŸ¥˜"}, 
        {e:"fork", c:"å‰å­", i:"ğŸ´"}, {e:"freezer", c:"å†°ç®±", i:"â„ï¸ğŸ§Š"}, {e:"French fries", c:"è–¯æ¢", i:"ğŸŸ"}, {e:"fruit", c:"æ°´æœ", i:"ğŸ‡ğŸ‰"}, 
        {e:"fry", c:"æ²¹ç…/ç‚’", i:"ğŸ³ğŸ¤"}, {e:"grape", c:"è‘¡è„", i:"ğŸ‡"}, {e:"guava", c:"èŠ­æ¨‚", i:"ğŸ"}, 
        {e:"ham", c:"ç«è…¿", i:"ğŸ¥“"}, // å„ªåŒ–ï¼šç”¨åŸ¹æ ¹ç‰‡ä»£è¡¨ç«è…¿ç‰‡
        {e:"hamburger", c:"æ¼¢å ¡", i:"ğŸ”"}, {e:"honey", c:"èœ‚èœœ", i:"ğŸ¯"}, {e:"hot dog", c:"ç†±ç‹—", i:"ğŸŒ­"}, {e:"ice cream", c:"å†°æ·‡æ·‹", i:"ğŸ¦"}, 
        {e:"juice", c:"æœæ±", i:"ğŸ§ƒ"}, {e:"ketchup", c:"ç•ªèŒ„é†¬", i:"ğŸ…ğŸ¥«"}, {e:"knife", c:"åˆ€å­", i:"ğŸ”ª"}, {e:"lemon", c:"æª¸æª¬", i:"ğŸ‹"}, 
        {e:"lettuce", c:"èµè‹£", i:"ğŸ¥—ğŸ¥¬"}, {e:"lick", c:"èˆ”", i:"ğŸ‘…ğŸ­"}, {e:"lunch", c:"åˆé¤", i:"â˜€ï¸ğŸ±"}, {e:"mango", c:"èŠ’æœ", i:"ğŸ¥­"}, 
        {e:"meal", c:"è†³é£Ÿ", i:"ğŸ¥˜ğŸš"}, 
        {e:"meat", c:"è‚‰", i:"ğŸ–"}, // å„ªåŒ–ï¼šç”¨å¸¶éª¨è‚‰ä»£è¡¨é€šç¨±çš„è‚‰
        {e:"menu", c:"èœå–®", i:"ğŸ“‹"}, {e:"microwave", c:"å¾®æ³¢çˆ", i:"ğŸ“Ÿ"}, 
        {e:"milk", c:"ç‰›å¥¶", i:"ğŸ¥›"}, {e:"napkin", c:"é¤å·¾ç´™", i:"ğŸ§»"}, {e:"noodle", c:"éºµ", i:"ğŸœ"}, {e:"nut", c:"å …æœ", i:"ğŸ¥œ"}, 
        {e:"oil", c:"æ²¹", i:"ğŸ«—"}, {e:"onion", c:"æ´‹è”¥", i:"ğŸ§…"}, {e:"orange", c:"æŸ³æ©™", i:"ğŸŠ"}, {e:"order", c:"é»é¤", i:"ğŸ™‹â€â™‚ï¸ğŸ“"}, 
        {e:"oven", c:"çƒ¤ç®±", i:"â™¨ï¸ğŸ¥§"}
    ];

    // --- éŠæˆ²ç‹€æ…‹è®Šæ•¸ ---
    let gameData = [];
    let currentLevel = 1;
    let currentQIndex = 0;
    let score = 10;
    let timerInterval;
    let timeLeft = 10;
    let currentPhase = 1; 
    let currentTarget = null;
    let currentOptions = []; 
    let confettiInterval = null; // æ–°å¢ï¼šæ§åˆ¶ Confetti çš„è¿´åœˆ

    // --- å·¥å…· ---
    function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }
    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        // åˆ‡æ›è¢å¹•æ™‚åœæ­¢ Confetti
        if(id !== 'win-screen') stopConfetti();
    }

    // --- æ–°å¢ï¼šConfetti æ§åˆ¶ ---
    function launchConfettiBurst() {
        for(let i=0; i<15; i++) {
            const c = document.createElement('div');
            c.className = 'confetti';
            c.style.left = Math.random() * 100 + '%';
            c.style.backgroundColor = `hsl(${Math.random()*360}, 100%, 50%)`;
            c.style.animationDuration = (Math.random() * 2 + 1) + 's';
            c.style.opacity = Math.random();
            document.body.appendChild(c);
            // å‹•ç•«çµæŸå¾Œç§»é™¤å…ƒç´ 
            setTimeout(() => c.remove(), 3000);
        }
    }

    function startContinuousConfetti() {
        stopConfetti(); // å…ˆæ¸…é™¤èˆŠçš„
        launchConfettiBurst(); // ç«‹å³ç™¼å°„ä¸€æ¬¡
        confettiInterval = setInterval(launchConfettiBurst, 800); // æ¯0.8ç§’ç™¼å°„ä¸€æ¬¡
    }

    function stopConfetti() {
        if(confettiInterval) {
            clearInterval(confettiInterval);
            confettiInterval = null;
        }
        // æ¸…é™¤ç•«é¢ä¸Šæ®˜ç•™çš„
        document.querySelectorAll('.confetti').forEach(c => c.remove());
    }


    // --- æ ¸å¿ƒé‚è¼¯ ---
    function initGame() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        score = 10;
        currentLevel = 1;
        gameData = shuffle([...database]);
        startLevel();
    }

    function startLevel() {
        currentQIndex = 0;
        document.getElementById('lvl-num').innerText = currentLevel;
        document.getElementById('score-num').innerText = score;
        switchScreen('game-screen');
        loadQuestion();
    }

    function loadQuestion() {
        if (currentQIndex >= 7) {
            // Level Clear
            if(currentLevel >= 11) {
                document.getElementById('final-score').innerText = score;
                switchScreen('win-screen');
                startContinuousConfetti(); // å•Ÿå‹•æŒçºŒæ…¶ç¥
            } else {
                currentLevel++;
                switchScreen('levelup-screen');
            }
            return;
        }

        currentPhase = 1;
        const globalIndex = ((currentLevel - 1) * 7) + currentQIndex;
        currentTarget = gameData[globalIndex];

        document.getElementById('q-emoji').innerText = currentTarget.i;
        
        const slotCn = document.getElementById('slot-cn');
        const slotEn = document.getElementById('slot-en');
        slotCn.className = 'slot-item'; slotCn.innerText = 'ä¸­æ–‡';
        slotEn.className = 'slot-item'; slotEn.innerText = 'English';

        document.getElementById('hint-text').innerText = "Step 1: é€™æ˜¯ä»€éº¼ï¼Ÿ(é¸ä¸­æ–‡)";
        document.getElementById('hint-text').style.color = "var(--primary)";

        prepareOptionsAndRender(); 
        startTimer();
    }

    function prepareOptionsAndRender() {
        let numOptions = 2;
        if (currentLevel >= 2) numOptions = 3;
        if (currentLevel >= 4) numOptions = 4;

        let pool = database.filter(i => i.e !== currentTarget.e);
        pool = shuffle(pool);
        let options = [currentTarget];
        for(let i=0; i<numOptions-1; i++) options.push(pool[i]);
        
        currentOptions = shuffle(options);

        const container = document.getElementById('options-container');
        container.innerHTML = '';
        container.style.gridTemplateColumns = numOptions > 2 ? '1fr 1fr' : '1fr';
        
        if(currentPhase === 1) {
            container.className = 'options-grid phase-cn';
        } else {
            container.className = 'options-grid phase-en';
        }

        currentOptions.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            if(currentPhase === 1) {
                btn.innerText = opt.c;
            } else {
                btn.innerText = opt.e;
            }
            btn.onclick = () => handleInput(opt);
            container.appendChild(btn);
        });
    }

    function startTimer() {
        clearInterval(timerInterval);
        timeLeft = 10;
        const bar = document.getElementById('timer-bar');
        bar.style.width = '100%';
        bar.style.background = 'var(--success)';

        timerInterval = setInterval(() => {
            timeLeft -= 0.1;
            const pct = (timeLeft / 10) * 100;
            bar.style.width = `${pct}%`;
            if(pct < 50) bar.style.background = 'var(--warning)';
            if(pct < 20) bar.style.background = 'var(--accent)';

            if(timeLeft <= 0) {
                clearInterval(timerInterval);
                handleFail(true);
            }
        }, 100);
    }

    function handleInput(selectedOpt) {
        const isCorrect = (selectedOpt.e === currentTarget.e);

        if(!isCorrect) {
            handleFail(false);
            return;
        }

        if(currentPhase === 1) {
            SoundFX.lock();
            const slotCn = document.getElementById('slot-cn');
            slotCn.innerText = currentTarget.c;
            slotCn.classList.add('filled', 'filled-cn');

            currentPhase = 2;
            document.getElementById('hint-text').innerText = "Step 2: å°æ‡‰çš„è‹±æ–‡æ˜¯ï¼Ÿ(å·²é‡æ–°æ´—ç‰Œ)";
            document.getElementById('hint-text').style.color = "var(--accent)";

            prepareOptionsAndRender(); 
            startTimer();

        } else {
            clearInterval(timerInterval);
            SoundFX.win();
            const slotEn = document.getElementById('slot-en');
            slotEn.innerText = currentTarget.e;
            slotEn.classList.add('filled', 'filled-en');

            const pts = 10 + (currentLevel - 1) * 5;
            score += pts;
            showFeedback(true, pts);
        }
    }

    function handleFail(isTimeout) {
        clearInterval(timerInterval);
        SoundFX.lose();
        const pts = 10 + (currentLevel - 1) * 5;
        score -= pts;
        if(score < 0) score = 0;
        showFeedback(false, pts);
    }

    function showFeedback(isSuccess, pts) {
        const overlay = document.getElementById('feedback-overlay');
        const icon = document.getElementById('fb-icon');
        const text = document.getElementById('fb-text');
        
        overlay.style.display = 'flex';
        
        if(isSuccess) {
            icon.innerText = "â­•";
            text.innerText = `Good! +${pts}`;
            text.style.color = "var(--success)";
        } else {
            icon.innerText = "âŒ";
            text.innerText = `Oops... -${pts}`;
            text.style.color = "var(--accent)";
        }

        document.getElementById('score-num').innerText = score;

        setTimeout(() => {
            overlay.style.display = 'none';
            if(score <= 0) {
                document.getElementById('gameover-screen').classList.add('active');
            } else {
                currentQIndex++;
                loadQuestion();
            }
        }, 1200);
    }

</script>
</body>
</html>
