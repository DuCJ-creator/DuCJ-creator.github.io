<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shirley's EMO Shredder (Text Restored)</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@900&family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* ================= STAR BACKGROUND ================= */
        @keyframes animStar {
            from { transform: translateY(0px) translateX(0px); }
            to   { transform: translateY(-1000px) translateX(-300px); }
        }
        .star-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; overflow: hidden;
        }
        #stars1 {
            z-index: -2; width: 2px; height: 2px; background: transparent;
            box-shadow: 10vw 10vh #fff, 20vw 80vh #fff, 80vw 10vh #fff, 90vw 50vh #fff, 30vw 30vh #fff, 40vw 90vh #fff, 70vw 20vh #fff, 10vw 60vh #fff, 50vw 10vh #fff, 60vw 80vh #fff, 15vw 45vh #fff, 85vw 35vh #fff, 25vw 25vh #fff, 75vw 75vh #fff, 95vw 15vh #fff, 05vw 95vh #fff;
            animation: animStar 60s linear infinite; opacity: 0.8;
        }

        /* ================= MAIN STYLES ================= */
        :root {
            --bg-color: #050505;
            --gold: #ffd700;
            --sticker-1: #fff0f5; --sticker-2: #e0fbfb; --sticker-3: #fffacd; --sticker-4: #e6e6fa; --sticker-5: #ffe4e1;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 120%, #1a0b2e 0%, #000000 70%);
            color: #fff;
            font-family: 'Zen Maru Gothic', sans-serif;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            padding-bottom: 120px; overflow-x: hidden; position: relative;
        }

        /* Header */
        header { text-align: center; padding: 40px 20px 20px; z-index: 10; }
        h1 {
            font-family: 'Cinzel', serif; font-size: clamp(2rem, 6vw, 3.5rem);
            background: linear-gradient(to bottom, #fff 20%, var(--gold) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5); margin-bottom: 10px; font-weight: 900;
        }
        .subtitle { color: #aaa; font-size: 0.9rem; letter-spacing: 4px; text-transform: uppercase; }

        /* --- STICKER WALL --- */
        .wall-section { width: 95%; max-width: 1200px; margin: 20px auto; z-index: 5; perspective: 1000px; }
        .wall-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 10px; }

        .note-card {
            width: 160px; min-height: 140px;
            background: #fff; color: #444;
            font-size: 0.95rem; line-height: 1.3;
            display: flex; align-items: center; justify-content: center; text-align: center;
            padding: 15px; cursor: pointer; position: relative; user-select: none;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3); font-weight: 700;
            border-radius: 20px; border: 3px solid transparent;
            white-space: pre-wrap; /* Allows line breaks from the data */
        }

        /* Shapes */
        .shape-cloud { border-radius: 64% 36% 58% 42% / 46% 70% 30% 54%; }
        .shape-blob { border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%; }
        .shape-egg { border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; }
        .shape-wonky { border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px; }

        .note-card:hover { transform: scale(1.1) rotate(0deg) !important; z-index: 20; box-shadow: 0 10px 25px rgba(255,255,255,0.2); }
        .note-card.selected {
            border-color: #ff4757; transform: scale(1.15) !important;
            box-shadow: 0 0 30px rgba(255, 71, 87, 0.6); z-index: 10; background: #fff; color: #000;
        }
        .note-card.selected::after {
            content: '✖'; position: absolute; top: -10px; right: -10px;
            background: #ff4757; color: white; width: 30px; height: 30px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .note-card.gone {
            opacity: 0; pointer-events: none; transform: scale(0) rotate(720deg); transition: all 0.6s ease-in;
        }

        /* --- Controls --- */
        .control-panel {
            width: 90%; max-width: 600px;
            background: rgba(30, 30, 35, 0.8); border: 1px solid rgba(255, 215, 0, 0.3);
            padding: 25px; border-radius: 20px; backdrop-filter: blur(15px); margin: 20px 0 50px 0;
            z-index: 6; box-shadow: 0 20px 50px rgba(0,0,0,0.6); display: flex; flex-direction: column; gap: 15px;
        }
        .control-panel h3 { color: var(--gold); text-align: center; margin: 0 0 5px 0; }
        textarea {
            width: 100%; height: 90px; background: rgba(255,255,255,0.1); border: 2px solid #555;
            color: #fff; padding: 15px; border-radius: 12px; font-size: 1rem; resize: none; font-family: 'Zen Maru Gothic', sans-serif; transition: border 0.3s;
        }
        textarea:focus { border-color: var(--gold); outline: none; background: rgba(255,255,255,0.15); }
        .btn-main-shred {
            width: 100%; padding: 16px; background: linear-gradient(135deg, #FFD700 0%, #FF8C00 100%);
            border: none; color: #000; font-weight: 900; font-size: 1.2rem; font-family: 'Cinzel', serif;
            cursor: pointer; border-radius: 50px; text-transform: uppercase; letter-spacing: 2px;
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.3); transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-main-shred:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(212, 175, 55, 0.6); }
        .btn-main-shred:disabled { background: #333; color: #666; cursor: not-allowed; box-shadow: none; transform: none; }

        /* --- Machine --- */
        .shredder-zone {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 140px;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            z-index: 50; pointer-events: none;
        }
        .machine-head {
            width: 360px; height: 70px; background: linear-gradient(to bottom, #2a2a2a, #000);
            border-radius: 12px 12px 0 0; border-top: 1px solid #444;
            box-shadow: 0 -10px 60px rgba(0,0,0,1); position: relative; display: flex; align-items: center; justify-content: center; z-index: 51;
        }
        .machine-slot { width: 300px; height: 8px; background: #000; border-radius: 10px; box-shadow: inset 0 0 10px #000; border: 1px solid #333; }
        .shredding-active { animation: shake 0.08s infinite; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 100% { transform: translate(-1px, -1px); } }

        /* --- Confetti (Paper Chips) --- */
        .shreds-container {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 320px; height: 300px; pointer-events: none; z-index: 60;
        }
        .confetti-strip { 
            position: absolute; width: 6px; height: 10px; top: 75px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        /* --- ENERGY BALL (Burning Star Effect) --- */
        .energy-ball-wrapper {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 100; pointer-events: none; display: flex; justify-content: center; align-items: center;
        }

        .the-sphere {
            width: 0px; height: 0px; opacity: 0; border-radius: 50%; position: relative;
            /* Star Core */
            background: radial-gradient(circle, #ffffff 10%, #ffd700 40%, #ff8c00 70%, transparent 100%);
            /* Sun-like Glow */
            box-shadow: 0 0 60px #ffd700, 0 0 120px #ff8c00, inset 0 0 20px #fff;
            filter: contrast(1.2) blur(3px);
            mix-blend-mode: screen;
        }
        
        /* Sun Rays */
        .the-sphere::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; 
            background: conic-gradient(from 0deg, transparent 0deg, rgba(255, 215, 0, 0.4) 10deg, transparent 20deg, rgba(255, 215, 0, 0.4) 30deg, transparent 40deg);
            border-radius: 50%;
            animation: rotateRays 12s linear infinite;
            filter: blur(5px);
        }

        @keyframes rotateRays { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .ball-animate-in { animation: sphereGrow 4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        .ball-explode { animation: sphereExplode 0.5s ease-out forwards; }

        @keyframes sphereGrow {
            0% { width: 0; height: 0; opacity: 0; }
            100% { width: 320px; height: 320px; opacity: 1; }
        }
        @keyframes sphereExplode {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(3); opacity: 0.8; filter: brightness(2) blur(10px); }
            100% { transform: scale(8); opacity: 0; }
        }

        /* --- PERMANENT PARTICLES --- */
        .energy-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 90; overflow: hidden; }
        
        .plus-particle {
            position: absolute; color: var(--gold); font-family: 'Cinzel', serif;
            font-weight: 900; text-shadow: 0 0 10px var(--gold), 0 0 20px #fff; user-select: none;
            opacity: 0; transform: scale(0);
        }
        
        @keyframes explodeOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
            50% { opacity: 1; }
            100% { opacity: 1; transform: translate(var(--tx), var(--ty)) scale(var(--scale)); }
        }

        @keyframes floatForever {
            0% { transform: translate(var(--tx), var(--ty)) scale(var(--scale)) rotate(0deg); }
            50% { transform: translate(calc(var(--tx) + 15px), calc(var(--ty) - 25px)) scale(var(--scale)) rotate(10deg); }
            100% { transform: translate(calc(var(--tx) - 15px), calc(var(--ty) + 25px)) scale(var(--scale)) rotate(-10deg); }
        }

        .shockwave {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; opacity: 0; pointer-events: none; z-index: 200;
        }
        .shockwave-active { animation: flash 1.5s ease-out forwards; }
        @keyframes flash { 0% { opacity: 1; } 100% { opacity: 0; } }
    </style>
</head>
<body>

    <div id="stars1" class="star-layer"></div>

    <header>
        <h1>Shirley's EMO Shredder</h1>
        <div class="subtitle">Select. Destroy. Rebirth.</div>
    </header>

    <div class="wall-section">
        <div class="wall-title" style="text-align:center; color:#888; margin-bottom:10px;">- 點擊選擇你的煩惱 (Click to Select) -</div>
        <div class="wall-grid" id="wallGrid"></div>
    </div>

    <div class="control-panel">
        <h3>自定義負能量 (Write your own)</h3>
        <textarea id="customInput" placeholder="寫下那些讓你心煩的事..."></textarea>
        <button class="btn-main-shred" onclick="startShreddingSequence()">
            徹底粉碎 (DESTROY)
        </button>
    </div>

    <div class="shredder-zone">
        <div class="machine-head" id="machine">
            <div class="machine-slot" id="machineSlot"></div>
        </div>
        <div class="shreds-container" id="shredsZone"></div>
    </div>

    <div class="energy-ball-wrapper">
        <div id="theSphere" class="the-sphere"></div>
    </div>

    <div id="shockwaveLayer" class="shockwave"></div>
    <div class="energy-overlay" id="energyLayer"></div>

    <script>
        // --- DATA RESTORED: 100% Match from your Screenshot 9.24.44 AM ---
        const negativeData = [
            "I'm swamped with work.\n我被段考、社團成發和競賽準備給淹沒了。",
            "I'm having a bad hair day.\n今天諸事不順，睡過頭、考砸了，真是個厭世日。",
            "I've spread myself too thin.\n我分身乏術，一個人要扛太多責任。",
            "I'm snowed under with work.\n補習作業像雪崩一樣埋住，熬夜已是家常便飯。",
            "Dealing with difficult people.\n應付那些擺爛組員或奧客，耗光我所有精力。",
            "Powerless.\n拚了命努力，成績還是毫無起色，無力感很絕望。",
            "The world is a nightmare.\n考試、排名、期望，構成無盡的噩夢。",
            "I just want to give up.\n想徹底躺平，什麼都不在乎了。",
            "Never sleep enough. \n睡眠不足。\n連睡滿6小時都是奢望。",
            "數學考卷爆炸。\n Bombed by the math test.",
            "分組報告只有我在做。\nOnly me doing the group project.",
            "人生好難。\n看不到盡頭。 Life is so hard.",
            "理智線秒斷。\nMy patience snaps instantly.",
            "贏不過別人。\nNo matter how hard I study.",
            "高壓循環。\nHigh-pressure nightmare on repeat.",
            "只想放空。\nJust want to zone out.",
            "數學題庫無底洞。\nMath is a bottomless pit.",
            "恨文言文。\nI hate classical Chinese.",
            "英文作文卡關。\nCan't write the essay.",
            "物理化學全錯。\nGot everything wrong.",
            "歷史年代混亂。\nDates are mixed up like congee.",
            "地理像抽象畫。\nAbstract art maps.",
            "記憶體不足。\nBrain shows 'insufficient memory'.",
            "只想時光倒流。\nWant to turn back time."
        ];
        
        const colors = ['var(--sticker-1)', 'var(--sticker-2)', 'var(--sticker-3)', 'var(--sticker-4)', 'var(--sticker-5)'];
        const shapes = ['shape-cloud', 'shape-blob', 'shape-egg', 'shape-wonky'];

        // --- INIT WALL ---
        const wallGrid = document.getElementById('wallGrid');
        negativeData.forEach((text, i) => {
            const card = document.createElement('div');
            card.className = `note-card ${shapes[i % shapes.length]}`;
            card.innerText = text; // Will handle \n correctly due to white-space: pre-wrap
            card.style.backgroundColor = colors[i % colors.length];
            card.style.transform = `rotate(${(Math.random() * 10) - 5}deg)`;
            card.dataset.color = colors[i % colors.length];
            card.onclick = () => card.classList.toggle('selected');
            wallGrid.appendChild(card);
        });

        // --- AUDIO SYSTEM ---
        let audioCtx;
        
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        // Shred Noise
        function playShredSound(duration) {
            const bufferSize = audioCtx.sampleRate * duration;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            let lastOut = 0;
            for (let i = 0; i < bufferSize; i++) {
                const white = Math.random() * 2 - 1;
                data[i] = (lastOut + (0.02 * white)) / 1.02;
                lastOut = data[i];
                data[i] *= 4.0; 
            }
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(1000, audioCtx.currentTime);
            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(1.0, audioCtx.currentTime); 
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + duration);
            noise.connect(filter).connect(gain).connect(audioCtx.destination);
            noise.start();
        }

        function playChargeSound() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(50, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 3);
            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.5, audioCtx.currentTime + 2.5);
            osc.connect(gain).connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 3.5);
        }

        // Happy Music
        function startHappyMusic() {
            const now = audioCtx.currentTime;
            const masterGain = audioCtx.createGain();
            masterGain.gain.value = 0.4;
            masterGain.connect(audioCtx.destination);
            // Simple D Major Arpeggio
            const notes = [587.33, 739.99, 880.00, 1174.66, 1479.98, 1760.00]; 
            for(let i=0; i<16; i++) {
                const osc = audioCtx.createOscillator();
                osc.type = 'triangle';
                const note = notes[Math.floor(Math.random() * notes.length)];
                osc.frequency.value = note;
                const noteGain = audioCtx.createGain();
                noteGain.gain.setValueAtTime(0, now + i*0.12);
                noteGain.gain.linearRampToValueAtTime(0.3, now + i*0.12 + 0.05);
                noteGain.gain.exponentialRampToValueAtTime(0.01, now + i*0.12 + 0.4);
                osc.connect(noteGain).connect(masterGain);
                osc.start(now + i*0.12);
                osc.stop(now + i*0.12 + 0.5);
            }
        }

        // --- MAIN LOGIC ---
        let isRunning = false;
        let confettiInterval;

        function startShreddingSequence() {
            if(isRunning) return;
            initAudio();

            const selected = document.querySelectorAll('.note-card.selected');
            const customVal = document.getElementById('customInput').value.trim();
            const inputField = document.getElementById('customInput');

            if(selected.length === 0 && !customVal) {
                alert("請先選擇或輸入你的煩惱！");
                return;
            }

            isRunning = true;
            const btn = document.querySelector('.btn-main-shred');
            btn.disabled = true;
            btn.innerText = "DESTROYING...";

            const machine = document.getElementById('machine');
            machine.classList.add('shredding-active');
            
            playShredSound(4.0);

            // Confetti
            confettiInterval = setInterval(() => {
                spawnConfetti(colors[Math.floor(Math.random()*colors.length)]);
            }, 60);

            // Phase 1: Fly In
            let delay = 0;
            const delayStep = 200;

            selected.forEach(card => {
                setTimeout(() => {
                    animateFly(card, card.dataset.color);
                    card.classList.remove('selected');
                    card.classList.add('gone');
                }, delay);
                delay += delayStep;
            });

            if(customVal) {
                setTimeout(() => {
                    const rect = inputField.getBoundingClientRect();
                    const dummy = { getBoundingClientRect: () => rect };
                    animateFly(dummy, '#fff', true);
                    inputField.value = '';
                }, delay);
                delay += delayStep;
            }

            // Phase 2: Gather Energy
            const shredEndTime = delay + 1500;
            setTimeout(() => {
                clearInterval(confettiInterval);
                machine.classList.remove('shredding-active');
                btn.innerText = "GATHERING LIGHT...";
                
                const sphere = document.getElementById('theSphere');
                sphere.className = 'the-sphere ball-animate-in';
                
                playChargeSound();
            }, shredEndTime);

            // Phase 3: EXPLODE & PERMANENT PARTICLES
            const explosionTime = shredEndTime + 3500;
            setTimeout(() => {
                const sphere = document.getElementById('theSphere');
                sphere.classList.remove('ball-animate-in');
                sphere.classList.add('ball-explode'); 
                
                startHappyMusic();

                const shock = document.getElementById('shockwaveLayer');
                shock.classList.add('shockwave-active');

                // SPAWN PERMANENT PARTICLES
                spawnPermanentParticles(); 

                btn.innerText = "POSITIVE VIBES FOREVER";
                
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerText = "SHRED MORE";
                    isRunning = false;
                    shock.classList.remove('shockwave-active');
                }, 3000);

            }, explosionTime);
        }

        // --- ANIMATIONS ---
        function animateFly(el, color) {
            const start = el.getBoundingClientRect();
            const slot = document.getElementById('machineSlot').getBoundingClientRect();
            
            const ghost = document.createElement('div');
            ghost.style.position = 'fixed';
            ghost.style.background = color;
            ghost.style.width = start.width + 'px';
            ghost.style.height = start.height + 'px';
            ghost.style.borderRadius = '50%'; 
            ghost.style.top = start.top + 'px';
            ghost.style.left = start.left + 'px';
            ghost.style.transition = 'all 0.6s ease-in';
            ghost.style.zIndex = '40';
            ghost.style.pointerEvents = 'none';
            document.body.appendChild(ghost);

            requestAnimationFrame(() => {
                ghost.style.top = slot.top + 'px';
                ghost.style.left = (slot.left + slot.width/2) + 'px';
                ghost.style.transform = 'scale(0.1)';
                ghost.style.opacity = '0';
            });
            setTimeout(() => ghost.remove(), 600);
        }

        // Confetti Function
        function spawnConfetti(color) {
            const zone = document.getElementById('shredsZone');
            const c = document.createElement('div');
            c.className = 'confetti-strip';
            c.style.background = color;
            c.style.left = (Math.random() * 280 + 10) + 'px'; 
            c.style.transform = `rotate(${Math.random()*360}deg)`;
            zone.appendChild(c);
            
            const fallDuration = Math.random() * 0.5 + 0.5;
            
            c.animate([
                { top: '75px', opacity: 1 },
                { top: '350px', opacity: 0 }
            ], {
                duration: fallDuration * 1000,
                easing: 'linear',
                fill: 'forwards'
            });

            setTimeout(() => c.remove(), fallDuration * 1000);
        }

        // Permanent Particles
        function spawnPermanentParticles() {
            const layer = document.getElementById('energyLayer');
            const particleCount = 200; 

            for(let i=0; i<particleCount; i++) {
                const p = document.createElement('div');
                p.className = 'plus-particle';
                p.innerText = '+++++';
                
                const size = Math.random() * 2 + 0.8; 
                p.style.fontSize = size + 'rem';
                
                const angle = Math.random() * Math.PI * 2;
                const velocity = (Math.random() * 90) + 10;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;

                p.style.setProperty('--tx', `${tx}vw`);
                p.style.setProperty('--ty', `${ty}vh`);
                p.style.setProperty('--scale', Math.random() * 0.5 + 0.5);
                
                p.style.top = '50%'; p.style.left = '50%';

                layer.appendChild(p);

                // 1. Explode
                p.style.animation = `explodeOut 1.5s cubic-bezier(0.1, 0.9, 0.2, 1) forwards`;

                // 2. Float Forever
                setTimeout(() => {
                    p.style.animation = `floatForever ${3 + Math.random()*4}s ease-in-out infinite alternate`;
                }, 1400);
            }
        }
    </script>
</body>
</html>
