<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,sans-serif;-webkit-tap-highlight-color:transparent;user-select:none;}
    body{background:#f8f4e5;padding:12px;display:flex;flex-direction:column;align-items:center;color:#5d4037;}
    h1{font-size:22px;margin:10px 0;color:#3e2723;text-align:center;}
    #msg{min-height:24px;font-size:16px;font-weight:bold;text-align:center;margin:6px 0;transition:opacity 0.3s;}
    .ctrl{display:flex;gap:8px;margin:6px 0;flex-wrap:wrap;justify-content:center;}
    button{padding:7px 12px;border:none;border-radius:10px;font-weight:bold;cursor:pointer;font-size:13px;}
    .d-btn{background:#ffecb3;color:#5d4037;}
    .d-btn.a{background:#ffb300;color:white;}
    #r, #chk{background:#ffd54f;color:#3e2723;}
    .sc{margin:12px 0;background:white;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);display:flex;justify-content:center;overflow:hidden;}
    .g{display:grid;gap:1px;background:#e65100;padding:2px;}
    .c{display:flex;align-items:center;justify-content:center;background:white;font-weight:bold;cursor:pointer;}
    .c.given{color:#3e2723;background:#fff8e1 !important;}
    .c.user{color:#e65100;}
    .c.err{background:#ffcdd2 !important;color:#c62828;}
    .c.sel{background:#ffe0b2 !important;outline:2px solid #e65100;}
    .c.highlight{background:#e8f5e9 !important;color:#2e7d32 !important;font-weight:bold;}
    .np{display:grid;grid-template-columns:repeat(6,1fr);gap:6px;margin-top:14px;width:100%;max-width:540px;}
    .nb{padding:10px 0;background:#fff8e1;color:#5d4037;font-size:16px;font-weight:bold;border-radius:8px;border:none;cursor:pointer;opacity:0.7;}
    .nb:hover{opacity:1;}
  </style>
</head>
<body>
  <h1>Shirley's Wordoku</h1>
  <div id="msg"></div>
  <div class="ctrl">
    <button class="d-btn a" data-s="3">ËºïÈ¨Ü (3√ó3)</button>
    <button class="d-btn" data-s="6">ÊåëÊà∞ (6√ó6)</button>
    <button class="d-btn" data-s="9">ÁáíËÖ¶ (9√ó9)</button>
    <button id="r">ÈáçÁΩÆ</button>
    <button id="chk">ÂÆåÊàêÊ™¢Êü•</button>
  </div>
  <div class="sc"><div class="g" id="g"></div></div>
  <div class="np" id="np"></div>

  <script>
    // ========== Âö¥Ê†ºÁØ©ÈÅ∏ÔºöÂ≠óÊØçÊï∏ = N ‰∏îÁÑ°ÈáçË§á ==========
    var w3 = "ACT,AGE,AIR,ARK,ARM,ASK,ATE,AWE,BAG,BAN,BED,BIG,BOX,BUS,BUT,BUY,CAN,CAP,CAR,CAT,COT,CUP,CUT,DRY,DUE,EAT,END,FAR,FAT,FIT,FLY,FOG,FOX,FUN,GUM,HAD,HAM,HAT,HIP,HIS,HOP,ICY,INK,JAM,JET,KEY,KID,LAP,LEG,LOG,MAN,MAP,MAT,NEW,NOW,OAR,OIL,ONE,OUR,OWL,OWN,PAD,PAN,PET,PIG,POP,POT,PUT,RAT,RED,ROW,RUN,SAD,SEA,SEE,SET,SIT,SIX,SKI,SOX,SUN,TAG,TAX,TEA,TEN,THE,TIN,TIP,TOP,TOY,URN,USE,VAN,VET,WAX,WET,YAK,YAW,YUM,ZOO";
    
    var w6 = "ACTION,AMIDST,AUTHOR,BLUELY,BRANCH,BREACH,BRIGHT,BUCKET,CANDID,CANYON,COLUMN,COMMIT,CONVEY,CREDIT,CUSTOM,CYCLER,DESERT,DESIGN,DIRECT,EDITOR,ENERGY,ENJOY,ENTIRE,FACTOR,FINITE,FOREST,FORMAT,FORTUNE,FRIGHT,FUTURE,GARDEN,GROUND,HARVEST,HONEST,IMPORT,ISLAND,JUNGLE,KIDNEY,KNIGHT,LABOUR,LEGACY,LENGTH,LESSON,MAKING,MANNER,MASTER,MEDIUM,MEMBER,METHOD,MINUTE,MOBILE,MODEL,MOMENT,MOTION,NOVELS,NUDGEY,ORANGE,OUTLET,PARADE,PENCIL,PEPPER,PERSON,PHRASE,PLASTIC,POCKET,POLICY,PRINCE,PROFIT,PROMPT,PROVIDE,PURPLE,PUTTER,QUARTZ,RATHER,REASON,RECENT,REFUND,REGION,REMOTE,RENDER,RESULT,RETAIL,REVIEW,ROLLER,SAFETY,SALUTE,SECRET,SENSOR,SERENE,SHAPE,SHADOW,SIGNET,SIMPLE,SINCERE,SIXTIES,SLIPPER,SOFTLY,SOLACE,SOURCE,SPHERE,SPLASH,SPRING,STATIC,STATUS,STEREO,STOCKY,STYLE,SUBMIT,SUCCESS,SUFFIX,SUMMER,SUPERB,SUPPLY,SURPRISE,SWITCH,SYMBOL,SYSTEM,TABOO,TACKLE,TAGGER,TALBOT,TANGLE,TARGET,TELEND,TEMPO,TENURE,THEORY,TONGUE,TOPAZ,TORQUE,TOXINS,TRANCE,TRANSLATE,TRAVEL,TRENCH,TRIAGE";
    
    var w9 = "EDUCATION,AMBULANCE,ABDUCTION,ABSOLUTELY,ADJUSTING,ALGORITHM,BLACKMAIL,BLUEPRINT,BRACKETS,BREWING,CHAMPIONS,COMPLAINS,CONFIDENT,COUGHING,CRACKLING,DESPERATE,DISCOVER,DOORBELL,DRAMATIC,EARTHLING,EMPATHIZE,ENCOUNTER,ENFORCED,ENGINEERS,EXEMPLARY,FACTORIZE,FAVORITES,FLAVORING,FORMULATE,FREIGHTER,GARNISHED,GLOWINGLY,GRACEFUL,GRATEFUL,HANDCUFFS,HARMONIZE,HOSPITAL,IMPOSTURE,INCENTIVE,INFORMANT,INTRIGUED,JUDGMENTS,JUNCTION,KALEIDOSCOPE,KILOBYTES,LANDSCAPE,LIGHTNING,LOGARITHM,MAGNIFIED,MALEFACTORS,MARATHONS,MENTALITY,MONKEYING,MOTHERLAND,MULTIFACED,MULTIPLAYER,MYSTIFIED,NEIGHBORS,NOTIFYING,NUTRITIVE,OBFUSCATED,OBSCURITY,OFFICIALS,OUTLINED,OVERHEARD,PACIFYING,PARALYZED,PARAMETERS,PASSIONATE,PERFECTLY,PHARMACIES,PHOTOGENIC,PLATINUM,PLAYGROUNDS,PLEADINGS,POETICALLY,POWERLESS,PROBLEMATIC,PROTECTIVE,QUADRUPLE,QUANTIZED,QUEASILY,QUESTIONED,QUICKLY,QUIVERING,RADIATION,REASONING,RECHARGED,RECOGNIZED,RECONCILED,REFORMING,REGISTERED,REGRETFUL,REJUVENATE,RELAXATION,REMARKABLY,RENDERING,REPLACEMENT,REPUBLICAN,RESPECTFUL,RESTORATION,REVERSIBLE,RIGHTFULLY,ROADBLOCKS,ROMANTIC,ROTUNDA,SAFEGUARD,SCANDALOUS,SCIENTIFIC,SCREENPLAY,SEAMANSHIP,SEGMENTED,SEMESTERS,SENSATION,SERIOUSLY,SHOCKWAVE,SHOWCASES,SIGNATURE,SIMPLIFIED,SKELETONS,SLAUGHTER,SLEEPWALK,SMOKESTACK,SOLITARY,SOUNDPROOF,SPECTACLE,SPHERICAL,STARGAZING,STEAMBOAT,STRAIGHTEN,STRATEGIC,STRENGTH,STRUCTURAL,SUBJECTED,SUBMARINE,SUCCESSFUL,SUFFERING,SUGGESTION,SUPERMARKET,SURPRISING,SWALLOWING,SYMMETRICAL,SYNCHRONIZE,SYNTHESIZE,TABLESPOON,TACTICALLY,TAILORED,TEACHABLE,TECHNICAL,TELEGRAPH,TELEPHONE,TEMPERATE,TENTACLES,TEXTBOOKS,THEORETICAL,TIGHTROPE,TIMBERLAND,TOLERANCE,TRANSLATE,TRIANGLE,TRIUMPHED,TRUSTWORTHY,TUNNELING,UNBELIEVABLE,UNCONSCIOUS,UNDERRATE,UNFRIENDLY,UNIQUELY,UPGRADED,VALIDATED,VALUABLE,VANDALIZED,VENTILATED,VERIFIABLE,VIRTUALLY,VOLATILITY,VOLUNTEERS,WANDERING,WARMLY,WEAPONIZED,WEIGHTLESS,WESTBOUND,WHEELCHAIR,WHISPERED,WILDFIRES,WILTING,WINDMILLS,WORKPLACE,YARDSTICK,YESTERDAY,ZEROGRAVITY";

    var bank = {3:w3.split(','), 6:w6.split(','), 9:w9.split(',')};
    var total = {3:5, 6:8, 9:11};
    var size = 3;
    var bd = [], sol = [], gn = [], sc = null, sp = null, act = [], av = [], chosenWord = "";

    document.addEventListener('touchmove', function(e) { e.preventDefault(); }, { passive: false });
    document.addEventListener('touchstart', function(e) { if (e.touches.length > 1) e.preventDefault(); }, { passive: false });
    var last = 0;
    document.addEventListener('touchend', function(e) {
      var now = Date.now();
      if (now - last <= 300) e.preventDefault();
      last = now;
    }, false);

    function uniq(s) {
      var seen = {};
      var res = [];
      var up = s.toUpperCase();
      for (var i = 0; i < up.length; i++) {
        var c = up[i];
        if (c >= 'A' && c <= 'Z' && !seen[c]) {
          seen[c] = 1;
          res.push(c);
        }
      }
      return res;
    }

    function supplement(base, n) {
      var res = [];
      for (var i = 0; i < base.length; i++) res.push(base[i]);
      if (res.length >= n) {
        for (var i = res.length - 1; i > 0; i--) {
          var j = Math.floor(Math.random() * (i + 1));
          var t = res[i]; res[i] = res[j]; res[j] = t;
        }
        return res.slice(0, n);
      }
      var all = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      for (var i = 0; i < all.length && res.length < n; i++) {
        var c = all[i];
        var found = 0;
        for (var j = 0; j < res.length; j++) {
          if (res[j] == c) { found = 1; break; }
        }
        if (!found) res.push(c);
      }
      for (var i = res.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var t = res[i]; res[i] = res[j]; res[j] = t;
      }
      return res.slice(0, n);
    }

    function solve(g, s, letters) {
      for (var r = 0; r < s; r++) {
        for (var c = 0; c < s; c++) {
          if (g[r][c] === '') {
            var sh = [];
            for (var i = 0; i < letters.length; i++) sh.push(letters[i]);
            for (var i = sh.length - 1; i > 0; i--) {
              var j = Math.floor(Math.random() * (i + 1));
              var t = sh[i]; sh[i] = sh[j]; sh[j] = t;
            }
            for (var k = 0; k < sh.length; k++) {
              var L = sh[k];
              var canPlace = true;
              for (var x = 0; x < s; x++) {
                if (g[r][x] === L || g[x][c] === L) { canPlace = false; break; }
              }
              if (canPlace && s > 3) {
                var bh = (s === 6) ? 2 : 3;
                var bw = (s === 6) ? 3 : 3;
                var sr = r - (r % bh), scol = c - (c % bw);
                for (var i = 0; i < bh; i++) {
                  for (var j = 0; j < bw; j++) {
                    if (g[sr + i][scol + j] === L) { canPlace = false; break; }
                  }
                  if (!canPlace) break;
                }
              }
              if (canPlace) {
                g[r][c] = L;
                if (solve(g, s, letters)) return true;
                g[r][c] = '';
              }
            }
            return false;
          }
        }
      }
      return true;
    }

    function gen(s) {
      var list = bank[s];
      // Á¢∫‰øùÈÅ∏Âà∞ÁöÑÂñÆÂ≠óÊúâË∂≥Â§†‰∏çÈáçË§áÂ≠óÊØç
      var validWords = [];
      for (var i = 0; i < list.length; i++) {
        var u = uniq(list[i]);
        if (u.length >= s) {
          validWords.push(list[i]);
        }
      }
      if (validWords.length === 0) validWords = list; // fallback
      chosenWord = validWords[Math.floor(Math.random() * validWords.length)];
      var ul = uniq(chosenWord);
      act = supplement(ul, s);
      av = supplement(ul, total[s]);

      sol = [];
      for (var i = 0; i < s; i++) {
        sol[i] = [];
        for (var j = 0; j < s; j++) sol[i][j] = '';
      }
      solve(sol, s, act);

      bd = [];
      gn = [];
      for (var i = 0; i < s; i++) {
        bd[i] = []; gn[i] = [];
        for (var j = 0; j < s; j++) {
          bd[i][j] = sol[i][j];
          if (Math.random() < (s === 3 ? 0.4 : (s === 6 ? 0.3 : 0.25))) {
            gn[i][j] = true;
          } else {
            gn[i][j] = false;
            bd[i][j] = '';
          }
        }
      }
    }

    function arraysEqual(a, b) {
      if (a.length !== b.length) return false;
      for (var i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) return false;
      }
      return true;
    }

    function checkHighlights() {
      var grid = document.getElementById('g');
      var cells = grid.querySelectorAll('.c');
      cells.forEach(cell => cell.classList.remove('highlight'));

      for (var i = 0; i < size; i++) {
        var rowLetters = [];
        var complete = true;
        for (var j = 0; j < size; j++) {
          var val = bd[i][j];
          if (val === '') {
            complete = false;
            break;
          }
          rowLetters.push(val);
        }
        if (complete && arraysEqual(rowLetters, act)) {
          for (var j = 0; j < size; j++) {
            var cell = document.querySelector('.c[data-r="' + i + '"][data-c="' + j + '"]');
            if (cell) cell.classList.add('highlight');
          }
        }
      }

      for (var j = 0; j < size; j++) {
        var colLetters = [];
        var complete = true;
        for (var i = 0; i < size; i++) {
          var val = bd[i][j];
          if (val === '') {
            complete = false;
            break;
          }
          colLetters.push(val);
        }
        if (complete && arraysEqual(colLetters, act)) {
          for (var i = 0; i < size; i++) {
            var cell = document.querySelector('.c[data-r="' + i + '"][data-c="' + j + '"]');
            if (cell) cell.classList.add('highlight');
          }
        }
      }
    }

    function render() {
      var ge = document.getElementById('g');
      ge.style.gridTemplateColumns = 'repeat(' + size + ', 1fr)';
      ge.innerHTML = '';

      var containerWidth;
      if (size === 3) containerWidth = 300;
      else if (size === 6) containerWidth = 480;
      else containerWidth = 540;

      var cs = Math.floor(containerWidth / size);
      var container = document.querySelector('.sc');
      container.style.width = containerWidth + 'px';

      for (var i = 0; i < size; i++) {
        for (var j = 0; j < size; j++) {
          var c = document.createElement('div');
          c.className = 'c';
          c.style.width = cs + 'px';
          c.style.height = cs + 'px';
          c.style.fontSize = Math.max(14, Math.floor(cs * 0.45)) + 'px';

          if (gn[i][j] && bd[i][j]) {
            c.textContent = bd[i][j];
            c.classList.add('given');
          } else if (bd[i][j]) {
            c.textContent = bd[i][j];
            c.classList.add('user');
          }

          c.dataset.r = i;
          c.dataset.c = j;
          c.addEventListener('click', function(e) {
            e.preventDefault();
            var r = parseInt(this.dataset.r);
            var c = parseInt(this.dataset.c);
            sel(r, c);
          });
          c.addEventListener('touchstart', function(e) {
            e.preventDefault();
            var r = parseInt(this.dataset.r);
            var c = parseInt(this.dataset.c);
            sel(r, c);
          });
          ge.appendChild(c);
        }
      }
      checkHighlights();
    }

    function renderPad() {
      var p = document.getElementById('np');
      p.innerHTML = '';
      var rows = Math.ceil(av.length / 6);
      p.style.gridTemplateRows = 'repeat(' + rows + ', 1fr)';

      for (var i = 0; i < av.length; i++) {
        var b = document.createElement('button');
        b.className = 'nb';
        b.textContent = av[i];
        b.addEventListener('click', function(e) {
          e.preventDefault();
          inL(this.textContent);
        });
        b.addEventListener('touchstart', function(e) {
          e.preventDefault();
          inL(this.textContent);
        });
        p.appendChild(b);
      }
    }

    function clear() {
      if (sc) sc.classList.remove('sel');
      sc = null;
      sp = null;
    }

    function sel(r, c) {
      if (gn[r][c]) return;
      clear();
      sc = document.querySelector('.c[data-r="' + r + '"][data-c="' + c + '"]');
      sp = {r: r, c: c};
      if (sc) sc.classList.add('sel');
    }

    function isInputValid(r, c, L, s) {
      if (L === '') return true;
      if (!/^[A-Z]$/.test(L)) return false;

      for (var j = 0; j < s; j++) {
        if (j !== c && bd[r][j] !== '' && bd[r][j] === L) {
          return false;
        }
      }

      for (var i = 0; i < s; i++) {
        if (i !== r && bd[i][c] !== '' && bd[i][c] === L) {
          return false;
        }
      }

      if (s > 3) {
        var bh = (s === 6) ? 2 : 3;
        var bw = (s === 6) ? 3 : 3;
        var sr = r - (r % bh);
        var scol = c - (c % bw);
        for (var i = 0; i < bh; i++) {
          for (var j = 0; j < bw; j++) {
            var rr = sr + i;
            var cc = scol + j;
            if ((rr !== r || cc !== c) && bd[rr][cc] !== '' && bd[rr][cc] === L) {
              return false;
            }
          }
        }
      }

      return true;
    }

    function inL(L) {
      if (!sp) return;
      var r = sp.r, c = sp.c;
      bd[r][c] = L;
      if (sc) {
        sc.textContent = L;
        sc.classList.remove('err', 'user');
        sc.classList.add('user');
        if (!isInputValid(r, c, L, size)) {
          sc.classList.add('err');
        }
      }
      checkHighlights();
    }

    function showMessage(text, isSuccess) {
      var msg = document.getElementById('msg');
      msg.textContent = text;
      msg.style.color = isSuccess ? '#2e7d32' : '#c62828';
      setTimeout(function() {
        msg.style.opacity = '0';
        setTimeout(function() {
          msg.textContent = '';
          msg.style.opacity = '1';
        }, 300);
      }, 3000);
    }

    function checkComplete() {
      for (var i = 0; i < size; i++) {
        for (var j = 0; j < size; j++) {
          if (bd[i][j] === '') {
            showMessage("ÈÇÑÊúâÁ©∫Ê†ºÂì¶ÔºåË´ãÂ°´ÊªøÂÜçÊ™¢Êü•ÔºÅ", false);
            return;
          }
        }
      }

      var allCorrect = true;
      for (var i = 0; i < size; i++) {
        for (var j = 0; j < size; j++) {
          if (bd[i][j] !== sol[i][j]) {
            allCorrect = false;
            break;
          }
        }
        if (!allCorrect) break;
      }

      if (allCorrect) {
        showMessage("ÂñÆÂ≠óÔºö" + chosenWord + "\nüéâ ÊÅ≠ÂñúÔºÅ\n‰Ω†ÊòØ ‚Äî‚Äî\nÁç®Â≠§Ê±ÇÊïóÔºÅ", true);
      } else {
        showMessage("ÈÇÑÊúâÈåØË™§Âì¶ÔºåÂä†Ê≤πÔºÅ", false);
      }
    }

    function reset() {
      gen(size);
      render();
      renderPad();
      clear();
      document.getElementById('msg').textContent = '';
    }

    function init(s) {
      size = s;
      var btns = document.querySelectorAll('.d-btn');
      for (var i = 0; i < btns.length; i++) {
        if (btns[i].dataset.s == s) {
          btns[i].classList.add('a');
        } else {
          btns[i].classList.remove('a');
        }
      }
      gen(s);
      render();
      renderPad();
      clear();
      document.getElementById('msg').textContent = '';
    }

    window.addEventListener('keydown', function(e) {
      if (!sp) return;
      var k = e.key;
      if (k == 'Delete' || k == 'Backspace' || k == ' ') {
        var r = sp.r, c = sp.c;
        if (!gn[r][c]) {
          bd[r][c] = '';
          if (sc) {
            sc.textContent = '';
            sc.classList.remove('err', 'user');
          }
          checkHighlights();
        }
        return;
      }
      var up = k.toUpperCase();
      if (/^[A-Z]$/.test(up)) {
        inL(up);
      }
    });

    var btns = document.querySelectorAll('.d-btn');
    for (var i = 0; i < btns.length; i++) {
      btns[i].addEventListener('click', function(e) {
        e.preventDefault();
        init(parseInt(this.dataset.s));
      });
      btns[i].addEventListener('touchstart', function(e) {
        e.preventDefault();
        init(parseInt(this.dataset.s));
      });
    }

    document.getElementById('r').addEventListener('click', function(e) {
      e.preventDefault();
      reset();
    });
    document.getElementById('r').addEventListener('touchstart', function(e) {
      e.preventDefault();
      reset();
    });

    document.getElementById('chk').addEventListener('click', function(e) {
      e.preventDefault();
      checkComplete();
    });
    document.getElementById('chk').addEventListener('touchstart', function(e) {
      e.preventDefault();
      checkComplete();
    });

    init(3);
  </script>
</body>
</html>
