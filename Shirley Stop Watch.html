<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Shirley's Athletic Stopwatch</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'SF Pro Display', 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            /* Athletic Dark Theme: Matte Charcoal/Black gradient */
            background: radial-gradient(circle at center, #2b3038 0%, #1a1c20 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #ffffff;
            touch-action: manipulation;
        }
        
        .container {
            background: rgba(30, 34, 40, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 30px;
            box-shadow: 
                0 20px 50px rgba(0, 0, 0, 0.5),
                inset 0 1px 1px rgba(255, 255, 255, 0.1);
            padding: 40px 30px;
            width: 100%;
            max-width: 500px; /* 稍微窄一點更像儀表板 */
            display: flex;
            flex-direction: column;
            gap: 30px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        /* 裝飾性背景光 */
        .glow-effect {
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 50% 50%, rgba(0, 242, 255, 0.03), transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        h1 {
            color: #ffffff;
            font-weight: 200;
            font-size: 1.8rem;
            letter-spacing: 2px;
            text-align: center;
            text-transform: uppercase;
            opacity: 0.9;
            z-index: 1;
        }
        
        /* 運動風格的圓環 */
        .track-container {
            width: 260px;
            height: 260px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 0 15px rgba(0, 242, 255, 0.2));
        }
        
        .track {
            width: 100%;
            height: 100%;
            position: relative;
            border-radius: 50%;
        }
        
        .track-bg {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border-radius: 50%;
            border: 8px solid rgba(255, 255, 255, 0.05);
        }
        
        .track-progress {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border-radius: 50%;
            /* 使用 conic-gradient 實現圓環進度 */
            background: conic-gradient(
                #00f2ff 0deg, 
                #00f2ff var(--angle, 0deg), 
                transparent var(--angle, 0deg), 
                transparent 360deg
            );
            /* 使用 mask 遮罩成環形 */
            -webkit-mask: radial-gradient(transparent 64%, black 65%);
            mask: radial-gradient(transparent 64%, black 65%);
            transition: background 0.05s linear; /* 更順滑的過渡 */
        }
        
        /* 增加進度條端點的光點 (可選，增加高級感) */
        .track-dot {
            position: absolute;
            top: 0; left: 50%;
            width: 12px; height: 12px;
            background: #ffffff;
            border-radius: 50%;
            transform-origin: 0 130px; /* 半徑 */
            transform: translateX(-50%) rotate(var(--angle, 0deg));
            box-shadow: 0 0 10px #00f2ff;
            z-index: 2;
            opacity: 0; /* 預設隱藏，開始才顯示 */
            transition: opacity 0.3s;
        }
        .track-dot.active { opacity: 1; }

        .track-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            width: 100%;
        }
        
        .stopwatch-display {
            font-size: 3.5rem;
            font-weight: 300;
            color: #ffffff;
            text-shadow: 0 0 20px rgba(0, 242, 255, 0.4);
            letter-spacing: 1px;
            font-variant-numeric: tabular-nums; /* 等寬數字，防止跳動 */
            font-family: 'SF Mono', 'Roboto Mono', monospace;
            line-height: 1;
        }
        
        .ms-display {
            font-size: 1.5rem;
            color: #00f2ff;
            font-weight: 400;
            margin-top: 5px;
            display: block;
            font-variant-numeric: tabular-nums;
            font-family: 'SF Mono', 'Roboto Mono', monospace;
        }
        
        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            z-index: 1;
        }
        
        .control-btn {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            outline: none;
        }
        
        /* Start/Resume Button - Electric Cyan */
        .start-btn {
            background: rgba(0, 242, 255, 0.15);
            color: #00f2ff;
            border: 1px solid rgba(0, 242, 255, 0.3);
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.1);
        }
        .start-btn:hover {
            background: rgba(0, 242, 255, 0.25);
            box-shadow: 0 0 25px rgba(0, 242, 255, 0.3);
            transform: scale(1.05);
        }
        .start-btn.running { /* 變成暫停樣式 */
            background: rgba(255, 71, 87, 0.15);
            color: #ff4757;
            border: 1px solid rgba(255, 71, 87, 0.3);
            box-shadow: 0 0 15px rgba(255, 71, 87, 0.1);
        }
        .start-btn.running:hover {
            background: rgba(255, 71, 87, 0.25);
            box-shadow: 0 0 25px rgba(255, 71, 87, 0.3);
        }
        
        /* Reset/Lap Buttons - Minimalist */
        .secondary-btn {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .secondary-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff;
            border-color: rgba(255, 255, 255, 0.3);
        }
        .secondary-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            border-color: transparent;
        }
        
        /* Lap List Styling */
        .laps-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: 10px 20px;
            height: 180px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            z-index: 1;
        }
        
        .laps-header {
            position: sticky;
            top: 0;
            background: rgba(36, 40, 48, 0.95); /* 配合背景色 */
            padding: 10px 0;
            color: #888;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 5px;
            z-index: 2;
        }
        
        .lap-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            font-size: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-family: 'SF Mono', 'Roboto Mono', monospace;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .lap-number {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .lap-time {
            color: #ffffff;
        }
        .lap-time.fastest { color: #00f2ff; } /* 最快圈速高亮 */
        .lap-time.slowest { color: #ff4757; } /* 最慢圈速高亮 */
        
        /* Scrollbar */
        .laps-container::-webkit-scrollbar {
            width: 4px;
        }
        .laps-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        /* 響應式 */
        @media (max-width: 480px) {
            .track-container { width: 220px; height: 220px; }
            .stopwatch-display { font-size: 3rem; }
            .ms-display { font-size: 1.2rem; }
            .track-bg { border-width: 6px; }
            .control-btn { width: 55px; height: 55px; font-size: 0.8rem; }
            .container { padding: 30px 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="glow-effect"></div>
        <h1>Shirley's Stop-Watch</h1>
        
        <div class="track-container">
            <div class="track">
                <div class="track-bg"></div>
                <div class="track-progress" id="trackProgress"></div>
                <div class="track-dot" id="trackDot"></div>
                
                <div class="track-center">
                    <div class="stopwatch-display" id="mainDisplay">00:00</div>
                    <div class="ms-display" id="msDisplay">.00</div>
                </div>
            </div>
        </div>
        
        <div class="control-buttons">
            <button class="control-btn secondary-btn" id="lapBtn" disabled>Lap</button>
            <button class="control-btn start-btn" id="startBtn">Start</button>
            <button class="control-btn secondary-btn" id="resetBtn" disabled>Reset</button>
        </div>
        
        <div class="laps-container">
            <div class="laps-header">
                <span>Lap No.</span>
                <span>Time</span>
            </div>
            <div id="lapsList"></div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const mainDisplay = document.getElementById('mainDisplay');
            const msDisplay = document.getElementById('msDisplay');
            const trackProgress = document.getElementById('trackProgress');
            const trackDot = document.getElementById('trackDot');
            const startBtn = document.getElementById('startBtn');
            const lapBtn = document.getElementById('lapBtn');
            const resetBtn = document.getElementById('resetBtn');
            const lapsList = document.getElementById('lapsList');
            
            // Logic Variables
            let startTime = 0;      // 記錄「這一次」按下開始的時間點
            let elapsedTime = 0;    // 記錄暫停前已經累積的總時間 (The Bank)
            let isRunning = false;
            let animationFrameId = null;
            
            // Lap Logic
            let lapCount = 0;
            let lastLapTotalTime = 0; // 上一次計圈時的總經過時間
            
            // Formatting: mm:ss
            function formatMain(ms) {
                const totalSeconds = Math.floor(ms / 1000);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // Formatting: .XX (centiseconds)
            function formatMs(ms) {
                const centiseconds = Math.floor((ms % 1000) / 10);
                return `.${centiseconds.toString().padStart(2, '0')}`;
            }
            
            // Formatting Full for Laps
            function formatFull(ms) {
                return formatMain(ms) + formatMs(ms);
            }
            
            function updateDisplay() {
                // 當前總時間 = (現在 - 開始) + 之前累積的
                const now = Date.now();
                const totalTime = (now - startTime) + elapsedTime;
                
                // 更新數字
                mainDisplay.textContent = formatMain(totalTime);
                msDisplay.textContent = formatMs(totalTime);
                
                // 更新圓環動畫 (60秒一圈)
                const totalSeconds = totalTime / 1000;
                const angle = (totalSeconds % 60) / 60 * 360;
                
                trackProgress.style.setProperty('--angle', angle + 'deg');
                trackDot.style.setProperty('--angle', angle + 'deg');
                
                animationFrameId = requestAnimationFrame(updateDisplay);
            }
            
            function toggleStopwatch() {
                if (!isRunning) {
                    // START / RESUME
                    isRunning = true;
                    // 關鍵修復：這裡只設置「新的開始點」，不改變累積時間
                    startTime = Date.now();
                    
                    animationFrameId = requestAnimationFrame(updateDisplay);
                    
                    // UI Updates
                    startBtn.textContent = 'Pause';
                    startBtn.classList.add('running');
                    lapBtn.disabled = false;
                    resetBtn.disabled = true; // 運動中不能 Reset，防止誤觸
                    trackDot.classList.add('active');
                    
                } else {
                    // PAUSE
                    isRunning = false;
                    cancelAnimationFrame(animationFrameId);
                    
                    // 關鍵修復：將這段時間累積到 elapsedTime
                    elapsedTime += Date.now() - startTime;
                    
                    // UI Updates
                    startBtn.textContent = 'Resume';
                    startBtn.classList.remove('running');
                    lapBtn.disabled = true; // 暫停時不能計圈
                    resetBtn.disabled = false; // 暫停時可以 Reset
                    trackDot.classList.remove('active');
                }
            }
            
            function recordLap() {
                if (!isRunning) return;
                
                lapCount++;
                
                // 計算當前總時間
                const currentTotalTime = (Date.now() - startTime) + elapsedTime;
                
                // 計算這一個 Lap 花的時間 (當前總時間 - 上次 Lap 的總時間)
                const thisLapTime = currentTotalTime - lastLapTotalTime;
                
                // 更新基準
                lastLapTotalTime = currentTotalTime;
                
                // 創建元素
                const lapItem = document.createElement('div');
                lapItem.className = 'lap-item';
                lapItem.innerHTML = `
                    <span class="lap-number">Lap ${lapCount.toString().padStart(2, '0')}</span>
                    <span class="lap-time">${formatFull(thisLapTime)}</span>
                `;
                
                // 插入到最上方
                if (lapsList.firstChild) {
                    lapsList.insertBefore(lapItem, lapsList.firstChild);
                } else {
                    lapsList.appendChild(lapItem);
                }
            }
            
            function resetStopwatch() {
                // 停止任何運行
                isRunning = false;
                cancelAnimationFrame(animationFrameId);
                
                // 重置所有變數
                startTime = 0;
                elapsedTime = 0;
                lapCount = 0;
                lastLapTotalTime = 0;
                
                // 重置顯示
                mainDisplay.textContent = '00:00';
                msDisplay.textContent = '.00';
                trackProgress.style.setProperty('--angle', '0deg');
                trackDot.style.setProperty('--angle', '0deg');
                lapsList.innerHTML = '';
                
                // 重置 UI
                startBtn.textContent = 'Start';
                startBtn.classList.remove('running');
                lapBtn.disabled = true;
                resetBtn.disabled = true;
                trackDot.classList.remove('active');
            }
            
            // Event Listeners
            startBtn.addEventListener('click', toggleStopwatch);
            lapBtn.addEventListener('click', recordLap);
            resetBtn.addEventListener('click', resetStopwatch);
            
            // Touch Optimization for Mobile
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(e) {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) e.preventDefault();
                lastTouchEnd = now;
            }, { passive: false });
        });
    </script>
</body>
</html>
