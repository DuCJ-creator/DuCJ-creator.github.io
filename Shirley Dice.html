<!DOCTYPE html>
<html lang="zh-TW" id="htmlRoot">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shirley's Pro Dice - Colorful Edition</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root { 
      --bg:#f8f9fa; --surface:#ffffff; --text:#2d3436; 
      --border:rgba(0,0,0,0.05); --dice-shadow: rgba(0,0,0,0.12);
    }
    .dark { 
      --bg:#121212; --surface:#1e1e1e; --text:#f5f6fa; 
      --border:rgba(255,255,255,0.08); --dice-shadow: rgba(0,0,0,0.4);
    }

    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    
    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: 'Inter', system-ui, sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .dice-wrapper {
      background: var(--surface);
      padding: 2rem;
      border-radius: 28px;
      box-shadow: 0 25px 50px -12px var(--dice-shadow);
      width: 90%;
      max-width: 360px;
      text-align: center;
      border: 1px solid var(--border);
    }

    h3 {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      opacity: 0.9;
    }

    .select-container {
      position: relative;
      margin-bottom: 2.5rem;
    }

    select {
      appearance: none;
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 14px 20px;
      border-radius: 16px;
      width: 100%;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    select:hover { border-color: #a29bfe; }

    .dice-stage {
      width: 140px;
      height: 140px;
      margin: 0 auto 2.5rem;
      perspective: 1000px;
      cursor: pointer;
    }

    .dice {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.9s cubic-bezier(0.15, 0.9, 0.3, 1.15);
      will-change: transform;
    }

    .dice-face {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 20px;
      backface-visibility: hidden;
      box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
      border: 1px solid rgba(0,0,0,0.05);
    }

    /* 多面體通用樣式 */
    .poly-face {
      font-weight: 600;
      font-size: 2.8rem;
      color: white;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .result-text {
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--text);
      opacity: 0.6;
    }

    .dot {
      position: absolute;
      width: 22px;
      height: 22px;
      background: #2d3436;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    }

    /* 動畫狀態 */
    .rolling { filter: contrast(1.1) brightness(1.1); }
  </style>
</head>
<body>

  <div class="dice-wrapper">
    <h3>Shirley's Dice</h3>
    
    <div class="select-container">
      <select id="diceType">
        <option value="4">d4 - 烈焰紅</option>
        <option value="6" selected>d6 - 象牙白</option>
        <option value="8">d8 - 寶石藍</option>
        <option value="12">d12 - 翡翠綠</option>
        <option value="20">d20 - 幻影紫</option>
      </select>
    </div>

    <div class="dice-stage" id="trigger">
      <div class="dice" id="dice"></div>
    </div>

    <div class="result-text" id="result">Tap to Roll</div>
  </div>

<script>
  const dice = document.getElementById('dice');
  const trigger = document.getElementById('trigger');
  const resultDisplay = document.getElementById('result');
  const diceTypeSelect = document.getElementById('diceType');
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  // 顏色配置表
  const config = {
    4:  { name: 'd4',  color: 'linear-gradient(135deg, #ff7675, #d63031)', clip: 'polygon(50% 0%, 0% 100%, 100% 100%)' },
    6:  { name: 'd6',  color: '#ffffff' },
    8:  { name: 'd8',  color: 'linear-gradient(135deg, #74b9ff, #0984e3)', clip: 'polygon(50% 0%, 0% 100%, 100% 100%)' },
    12: { name: 'd12', color: 'linear-gradient(135deg, #55efc4, #00b894)', clip: 'polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%)' },
    20: { name: 'd20', color: 'linear-gradient(135deg, #a29bfe, #6c5ce7)', clip: 'polygon(50% 0%, 0% 100%, 100% 100%)' }
  };

  let isRolling = false;

  function playSound() {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(150, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.1);
    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
    gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
    osc.start(); osc.stop(audioCtx.currentTime + 0.1);
  }

  function setupDice(sides) {
    dice.innerHTML = '';
    dice.style.transform = 'rotateX(0) rotateY(0)';
    const c = config[sides];

    if (sides === 6) {
      // D6 特殊處理：六面體
      const dotsMap = [
        [[50,50]], [[25,25],[75,75]], [[25,25],[50,50],[75,75]],
        [[25,25],[25,75],[75,25],[75,75]], [[25,25],[25,75],[75,25],[75,75],[50,50]],
        [[25,20],[25,50],[25,80],[75,20],[75,50],[75,80]]
      ];
      const trans = [
        'rotateY(0deg) translateZ(70px)', 'rotateY(90deg) translateZ(70px)',
        'rotateY(180deg) translateZ(70px)', 'rotateY(-90deg) translateZ(70px)',
        'rotateX(90deg) translateZ(70px)', 'rotateX(-90deg) translateZ(70px)'
      ];
      dotsMap.forEach((dots, i) => {
        const face = document.createElement('div');
        face.className = 'dice-face';
        face.style.background = c.color;
        face.style.transform = trans[i];
        dots.forEach(([x, y]) => {
          const dot = document.createElement('div');
          dot.className = 'dot';
          dot.style.left = `${x}%`; dot.style.top = `${y}%`;
          face.appendChild(dot);
        });
        dice.appendChild(face);
      });
    } else {
      // 多面體處理
      const face = document.createElement('div');
      face.className = 'dice-face poly-face';
      face.style.background = c.color;
      face.style.clipPath = c.clip;
      face.textContent = '?';
      dice.appendChild(face);
    }
  }

  function roll() {
    if (isRolling) return;
    isRolling = true;
    const sides = parseInt(diceTypeSelect.value);
    
    playSound();
    resultDisplay.textContent = 'Rolling...';
    dice.classList.add('rolling');

    const rx = Math.floor(Math.random() * 1000) + 720;
    const ry = Math.floor(Math.random() * 1000) + 720;
    dice.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg) rotateZ(${Math.random()*90}deg)`;

    setTimeout(() => {
      const val = Math.floor(Math.random() * sides) + 1;
      if (sides === 6) {
        const targets = [[0,0], [0,-90], [0,-180], [0,90], [-90,0], [90,0]];
        const [tx, ty] = targets[val-1];
        dice.style.transform = `rotateX(${Math.round(rx/360)*360 + tx}deg) rotateY(${Math.round(ry/360)*360 + ty}deg) rotateZ(0deg)`;
      } else {
        dice.querySelector('.poly-face').textContent = val;
        dice.style.transform = `rotateX(0deg) rotateY(0deg) scale(1.1)`;
        setTimeout(() => dice.style.transform = `rotateX(0deg) scale(1)`, 100);
      }
      resultDisplay.textContent = `Result: ${val}`;
      dice.classList.remove('rolling');
      isRolling = false;
    }, 850);
  }

  diceTypeSelect.addEventListener('change', (e) => setupDice(parseInt(e.target.value)));
  trigger.addEventListener('click', roll);
  setupDice(6); // 預設 D6

  // Dark Mode Support
  if (localStorage.getItem('theme') === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.getElementById('htmlRoot').classList.add('dark');
  }
</script>
</body>
</html>
